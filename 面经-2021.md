# 2021.01.09
## 阿里云一面
问：多个业务功能，spring层面怎么分发请求？策略模式怎么用？如果功能发生增删该怎么处理。
答：spring中，基本不需要使用工厂手动创建对象，BeanFactory已经做了。更多的是使用策略模式，创建多个接口的实现类，
根据需要使用不同的实现类（策略）。

问：组合索引列的顺序怎么设计。不是根据长度。根据区分度。
答：常用列放在前面；区分度高的列放在前面（重复值少，比如主键、唯一键。时间字段不适合放在索引的左侧）。

问：订单表很大，遇到什么性能问题？如何优化？（冷数据归档、分表）冷数据就不要放缓存了。
答：订单表归档，三个月前的订单移到归档表。如果必须分表，可以根据accountId进行分库分表。

问：查询优化有哪些手段？lucence的原理是什么？
答：如果建索引不能满足查询需求，可以把数据导入ElasticSearch进行查找。
mysql中通过like可以进行搜索。但是除了'like%'的形式，'%like%'是无法使用索引的。
lucence是通过倒排索引进行全文搜索的。通过将文本分词，构建文本到记录id列表的映射。
倒排索引在存储结构上是一棵查找树（不是map），查找效率高，但是修改效率低。适合不会经常变动的文本的查找。
查找时，将查找文本进行分词，每个词在倒排索引中进行查找。对查找结果进行排序并返回。
lucence中各个概念同mysql对照：INDEX:表，DOCUMENT:行，FIELD:列，MAPPING:表结构。
通过curl的http操作，建INDEX，插入DOCUMENT后，就可以进行全文搜索了。

问：分表中间件有哪些，使用proxy中间件比起sdk方式有什么优势？
答：

问：分表以后，怎么解决数据的幂等性问题。分表后，根据唯一索引去重还行吗？
答：

问：rabbitmq的事务特性实现原理。
答：rabbitmq支持事务，但仅仅是mq事务，为了确保生产者把消息发送到broker，与确保本地数据库事务和消息发送原子性不是一回事。
在确认消息发送到broker这一需求上，更合理的用法是使用确认机制+消息持久化，而不是使用rabbitmq事务。
支持本地事务和消息发送原子事务的，只有rocketmq。
rocketmq减少了本地消息表需要维护消息表和发送任务的繁琐，但是由于需要和broker进行2pc，生产端的效率会受影响。
rocketmq生产者和broker采用2pc。
prepare阶段会把消息发到broker，作为半消息，不会被消费；
prepare成功后会回调本地事务，根据本地事务的状态决定第二阶段消息是commit还是rollback。
如果回调本地事务后状态是unknown，则broker会周期性的回调查询事务状态接口，确认是需要commit还是rollback。

问：消费端重试数次后依然失败，如何保证最终一致？
答：消息队列的事务（rocketmq）只是保证发送端的原子性。消费端确保消费的问题，与生产端事务无关。

问：除了本地消息表还有哪些一致性手段？为什么没用2PC？
答：Seata AT，TCC模式。Rocketmq事务消息。XA事务。

面试组所在业务：帮助电信等运营商推广商品。涉及订单流转的业务，数据一致性，

# 2021.01.10
## 头条一面
如何保证订单不会重复下过来？app端external_id怎么生成的？

## 头条二面
二叉树镜像反转；数组左侧第一个比他大的值。

2G内存如何读入4G程序？线程切换能实现吗？

操作系统熟悉哪一块？

磁盘快满了，如何排查？

分表后，如何保证事务？

TCP连接断开过程是怎样的？time wait

文件很大，如何找到第n条数据？如何进行文件排序？

innodb范围查找的过程是怎样的？
